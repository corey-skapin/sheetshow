/// Known jazz standard titles for fuzzy matching against OCR results.
///
/// Song titles are not copyrightable — this is a factual reference list
/// compiled from published Real Book indices and jazz standard databases.
class JazzStandards {
  JazzStandards._();

  /// Find the best matching known title for an OCR'd string.
  /// Returns the known title if similarity >= [threshold] (0.0–1.0),
  /// otherwise returns null.
  static String? fuzzyMatch(String ocrTitle, {double threshold = 0.70}) {
    if (ocrTitle.isEmpty) return null;
    final lower = _ocrNormalize(ocrTitle.toLowerCase().trim());
    if (lower.isEmpty) return null;

    String? bestMatch;
    double bestScore = 0;

    for (final known in titles) {
      final knownLower = known.toLowerCase();
      // Quick exact check.
      if (lower == knownLower) return known;

      // Skip if lengths are too different — avoids false matches like
      // "Sound Lee" → "Donna Lee" or short OCR fragments matching long titles.
      final lenRatio = lower.length < knownLower.length
          ? lower.length / knownLower.length
          : knownLower.length / lower.length;
      if (lenRatio < 0.5) continue;

      final score = _similarity(lower, knownLower);
      if (score > bestScore) {
        bestScore = score;
        bestMatch = known;
      }
    }

    return bestScore >= threshold ? bestMatch : null;
  }

  /// Normalize common OCR misreads: `1` ↔ `i/l`, `0` ↔ `o` in title context.
  static String _ocrNormalize(String text) {
    // Replace standalone `1` (surrounded by spaces or at word boundaries)
    // with `I` when it looks like a word (e.g., "1 get" → "i get").
    return text.replaceAllMapped(
      RegExp(r'(?<=\s|^)1(?=\s|$)'),
      (m) => 'i',
    );
  }

  /// Normalized string similarity (0.0–1.0) using Levenshtein distance.
  static double _similarity(String a, String b) {
    if (a == b) return 1.0;
    if (a.isEmpty || b.isEmpty) return 0.0;
    final dist = _levenshtein(a, b);
    final maxLen = a.length > b.length ? a.length : b.length;
    return 1.0 - (dist / maxLen);
  }

  /// Levenshtein edit distance (optimised single-row DP).
  static int _levenshtein(String a, String b) {
    if (a.length < b.length) {
      final tmp = a;
      a = b;
      b = tmp;
    }
    final m = a.length, n = b.length;
    var prev = List<int>.generate(n + 1, (i) => i);
    var curr = List<int>.filled(n + 1, 0);

    for (int i = 1; i <= m; i++) {
      curr[0] = i;
      for (int j = 1; j <= n; j++) {
        final cost = a[i - 1] == b[j - 1] ? 0 : 1;
        curr[j] = [
          prev[j] + 1, // deletion
          curr[j - 1] + 1, // insertion
          prev[j - 1] + cost, // substitution
        ].reduce((a, b) => a < b ? a : b);
      }
      final tmp = prev;
      prev = curr;
      curr = tmp;
    }
    return prev[n];
  }

  /// Comprehensive list of jazz standard titles from Real Book volumes,
  /// New Real Book, Standards Real Book, and other common fake books.
  static const List<String> titles = [
    "'Round Midnight",
    "'S Wonderful",
    "2 Degrees East, 3 Degrees West",
    "26-2",
    "34 Skidoo",
    "4 A.M.",
    "500 Miles High",
    "502 Blues",
    "A Child Is Born",
    "A Family Joy",
    "A Fine Romance",
    "A Foggy Day",
    "A Night In Tunisia",
    "A Sleepin' Bee",
    "Actual Proof",
    "African Flower",
    "Afro Blue",
    "Afro-Centric",
    "After The Love Has Gone",
    "After The Rain",
    "After You've Gone",
    "Afternoon In Paris",
    "Again",
    "Airegin",
    "Ain't Misbehavin'",
    "Ain't No Sunshine",
    "Airmail Special",
    "Alfie's Theme",
    "Alice In Wonderland",
    "All Blues",
    "All God's Chillun Got Rhythm",
    "All My Tomorrows",
    "All Of Me",
    "All Of You",
    "All Or Nothing At All",
    "All The Things You Are",
    "All The Way",
    "All Through The Night",
    "Alone Together",
    "Along Came Betty",
    "Always There",
    "Ana Maria",
    "And On The Third Day",
    "And The Angels Sing",
    "Angel Eyes",
    "Anthropology",
    "April In Paris",
    "April Joy",
    "Are You Real?",
    "Arise, Her Eyes",
    "Armageddon",
    "Around Again",
    "As Time Goes By",
    "Au Privave",
    "Autumn In New York",
    "Autumn Leaves",
    "Bags' Groove",
    "Ba-Lue Bolivar Ba-Lues-Are",
    "Ballad For Trane",
    "Barbados",
    "Basin Street Blues",
    "Be Bop",
    "Beautiful Love",
    "Beauty And The Beast",
    "Bebop",
    "Beethoven's Blue 3rd",
    "Begin The Beguine",
    "Beneath It All",
    "Bernie's Tune",
    "Bessie's Blues",
    "Better Git It In Your Soul",
    "Bewitched",
    "Beyond All Limits",
    "Big Nick",
    "Billie's Bounce",
    "Bill's Hit Tune",
    "Bird Food",
    "Birdland",
    "Birk's Works",
    "Birth Of The Blues",
    "Bitter Suite In The Ozone",
    "Black And Tan Fantasy",
    "Black Diamond",
    "Black Narcissus",
    "Black Nile",
    "Black Orpheus",
    "Blame It On My Youth",
    "Blessed Relief",
    "Bloomdido",
    "Blue A La Mode",
    "Blue And Sentimental",
    "Blue Bossa",
    "Blue Comedy",
    "Blue Daniel",
    "Blue In Green",
    "Blue Monk",
    "Blue Moon",
    "Blue Room",
    "Blue Seven",
    "Blue Silver",
    "Blue Train",
    "Blues By Five",
    "Blues Connotation",
    "Blues For Alice",
    "Blues For Philly Joe",
    "Blues For Wood",
    "Blues In The Closet",
    "Blues In The Night",
    "Bluesette",
    "Body And Soul",
    "Bohemia After Dark",
    "Bolivia",
    "Boogie Stop Shuffle",
    "Booker's Waltz",
    "Boplicity",
    "Born To Be Blue",
    "Boston Marathon",
    "Bouncing With Bud",
    "Bouncin' With Bud",
    "Brainville",
    "Bright Size Life",
    "Broadway Blues",
    "Brownout",
    "But Beautiful",
    "But Not For Me",
    "Butterfly",
    "Bye Bye Blackbird",
    "Cantaloupe Island",
    "Canyon Song",
    "Captain Marvel",
    "Caravan",
    "Careful",
    "Careless Love",
    "Central Park West",
    "Ceora",
    "Chameleon",
    "Charade",
    "Chasin' The Trane",
    "Cheese Cake",
    "Chega De Saudade",
    "Chelsea Bells",
    "Chelsea Bridge",
    "Cherokee",
    "Chicken Feathers",
    "Children's Song",
    "Chippie",
    "Circle",
    "Close Enough For Love",
    "Close To You",
    "Close Your Eyes",
    "Cold Duck Time",
    "Colors Of Chloe",
    "Come Rain Or Come Shine",
    "Come Sunday",
    "Comin' Home Baby",
    "Como En Vietnam",
    "Compared To What",
    "Con Alma",
    "Conception",
    "Conference Of Birds",
    "Confirmation",
    "Coral",
    "Corcovado",
    "Cottontail",
    "Could It Be You",
    "Countdown",
    "Country Roads",
    "Crescent",
    "Criss Cross",
    "Crystal Silence",
    "Cute",
    "Daahoud",
    "Dancing On The Ceiling",
    "Darn That Dream",
    "Day By Day",
    "Day Dream",
    "Day In Vienna",
    "Days And Nights Waiting",
    "Days Of Wine And Roses",
    "Day Waves",
    "Dear Lord",
    "Dear Old Stockholm",
    "Dearly Beloved",
    "Decision",
    "Deep Purple",
    "Delores",
    "Deluge",
    "De Pois De Amor O'Vazio",
    "Desafinado",
    "Desert Air",
    "Dewey Square",
    "Dexterity",
    "Dig",
    "Dindi",
    "Django",
    "Do Nothing Till You Hear From Me",
    "Doin' The Pig",
    "Dolphin Dance",
    "Dolphin, The",
    "Domingo",
    "Domino Biscuit",
    "Don't Blame Me",
    "Don't Get Around Much Anymore",
    "Don't Go To Strangers",
    "Don't Worry 'Bout Me",
    "Donna Lee",
    "Doodlin'",
    "Duplicities",
    "Duke, The",
    "E.S.P.",
    "Early Autumn",
    "Easy Living",
    "Easy To Love",
    "Ecclesiastics",
    "Eclypso",
    "Eiderdown",
    "Eighty One",
    "Einbahnstrasse",
    "El Gaucho",
    "Eli's Theme",
    "Elora",
    "Embraceable You",
    "Emily",
    "Empathy",
    "Epistrophy",
    "Equinox",
    "Equipoise",
    "Evidence",
    "Everything I Have Is Yours",
    "Exercise",
    "Eye Of The Hurricane",
    "Ezz-thetic",
    "Fables Of Faubus",
    "Fall",
    "Falling Grace",
    "Falling In Love With Love",
    "Fee-Fi-Fo-Fum",
    "Feels So Good",
    "Feelings And Things",
    "Fields We Know, The",
    "52nd Street Theme",
    "Five Brothers",
    "Five Hundred Miles High",
    "Five Spot After Dark",
    "Flags",
    "Flim Flam",
    "Fly By Night",
    "Fly Me To The Moon",
    "Flying Home",
    "Follow Your Heart",
    "Fools Rush In",
    "Footprints",
    "For Heaven's Sake",
    "For Minors Only",
    "Forest Flower",
    "Fortune Smiles",
    "Four",
    "Four Brothers",
    "Fox Hunt",
    "Four On Six",
    "Four Winds",
    "Freddie The Freeloader",
    "Freedom Jazz Dance",
    "Friday The 13th",
    "Games People Play",
    "Gary's Waltz",
    "Gemini",
    "General Mojo's Well Laid Plan",
    "Gentle Rain",
    "Gentle Wind And Falling Tear",
    "Georgia On My Mind",
    "Get Out Of Town",
    "Giant Steps",
    "Ghost Of A Chance",
    "Girl From Ipanema, The",
    "Girl Talk",
    "Gloria's Step",
    "God Bless The Child",
    "Golden Lady",
    "Golden Notebooks",
    "Gone With The Wind",
    "Good Bait",
    "Good Evening Mr. And Mrs. America",
    "Goodbye",
    "Goodbye Pork Pie Hat",
    "Grand Central",
    "Green Dolphin Street",
    "Green Mountains",
    "Gregory Is Here",
    "Groovin' High",
    "Groove Merchant",
    "Groove Yard",
    "Groovy Samba",
    "Hackensack",
    "Half Nelson",
    "Hallucinations",
    "Happy Little Sunbeam",
    "Harlequin",
    "Hassan's Dream",
    "Have You Met Miss Jones",
    "Havona",
    "Head And Shoulders",
    "Heaven",
    "Hello Lovers",
    "Here's That Rainy Day",
    "Herzog",
    "Hi Beck",
    "Hi Fly",
    "Ho-Ba-La-La",
    "Hocus Pocus",
    "Hold Out Your Hand",
    "Horacescope",
    "Horizon",
    "Hotel Hello",
    "Hotel Overture",
    "Hotel Vamp",
    "House Of Jade",
    "How Deep Is The Ocean",
    "How High The Moon",
    "How Insensitive",
    "How My Heart Sings",
    "Hullo, Bolinas",
    "Humpty Dumpty",
    "I Believe In You",
    "I Can't Get Started",
    "I Could Write A Book",
    "I Cover The Waterfront",
    "I Get A Kick Out Of You",
    "I Got It Bad",
    "I Hear A Rhapsody",
    "I Let A Song Go Out Of My Heart",
    "I Love You",
    "I Mean You",
    "I Remember Clifford",
    "I Remember You",
    "I Should Care",
    "I Thought About You",
    "I Will Wait For You",
    "I'm A Fool To Want You",
    "I'm Getting Sentimental Over You",
    "Ice Cream Konitz",
    "Icarus",
    "Ictus",
    "Ida Lupino",
    "Idol Gossip",
    "If I Loved You",
    "If I Should Lose You",
    "If I Were A Bell",
    "If You Could See Me Now",
    "I'll Remember April",
    "I'm All Smiles",
    "I'm Your Pal",
    "Imagination",
    "Impressions",
    "In A Mellow Tone",
    "In A Sentimental Mood",
    "In Case You Haven't Heard",
    "In Pursuit Of The 27th Man",
    "In Walked Bud",
    "Incentive",
    "Inchworm",
    "Indian Lady",
    "Indiana",
    "Inner Urge",
    "Inside In",
    "Interplay",
    "Intrepid Fox",
    "In Your Own Sweet Way",
    "In Your Quiet Place",
    "Iris",
    "Isn't It Romantic",
    "Isotope",
    "Israel",
    "It Could Happen To You",
    "It Don't Mean A Thing",
    "It Had To Be You",
    "It Might As Well Be Spring",
    "It's A Raggy Waltz",
    "It's Only A Paper Moon",
    "I've Found A New Baby",
    "Jackie",
    "Jeannine",
    "Jelly",
    "Jinrikisha",
    "Jitterbug Waltz",
    "Jordu",
    "Journey To Recife",
    "Joy Spring",
    "Ju-Ju",
    "Jump Monk",
    "June 15th, 1967",
    "Just Friends",
    "Killer Joe",
    "La Fiesta",
    "Lady Bird",
    "Lakes",
    "Lament",
    "Las Vegas Tango",
    "Laura",
    "Lazy Bird",
    "Lennie's Pennies",
    "Leroy The Magician",
    "Lester Leaps In",
    "Lie Awake",
    "Light As A Feather",
    "Like Someone In Love",
    "Like Sonny",
    "Limehouse Blues",
    "Line For Lyons",
    "Litha",
    "Little B's Poem",
    "Little Chicago Fire",
    "Little Niles",
    "Little Rootie Tootie",
    "Little Sunflower",
    "Little Waltz",
    "Liturgy",
    "Locomotion",
    "Long Ago And Far Away",
    "Lonely Dreams",
    "Lonnie's Lament",
    "Look To The Sky",
    "Looking Back",
    "Love For Sale",
    "Love Vibrations",
    "Lover",
    "Lover Man",
    "Lucky Southern",
    "Lullaby Of Birdland",
    "Lush Life",
    "Magician In You, The",
    "Maiden Voyage",
    "Make Someone Happy",
    "Man I Love, The",
    "Man In The Green Shirt",
    "Manteca",
    "Masquerade",
    "May Dance",
    "May-Reh",
    "Meditation",
    "Mellow Mood",
    "Memories Of Tomorrow",
    "Memories Of You",
    "Memphis Underground",
    "Menina Flor",
    "Mercy, Mercy, Mercy",
    "Mevlevia",
    "Michelle",
    "Midnight Mode",
    "Milano",
    "Miles Ahead",
    "Minority",
    "Minor Mishap",
    "Minor Mood",
    "Misty",
    "Miyako",
    "Moanin'",
    "Moment's Notice",
    "Molten Glass",
    "Monk's Mood",
    "Montage",
    "Mood Indigo",
    "Moon Germs",
    "Moon Glow",
    "Moon Rays",
    "Moonchild",
    "Moontrane",
    "Moose The Mooche",
    "More I See You, The",
    "Moten's Swing",
    "Mother Of The Dead Man",
    "Move",
    "Moving Out",
    "Mr. Clean",
    "Mr. Jones",
    "Mr. Magic",
    "My Favorite Things",
    "My Foolish Heart",
    "My Funny Valentine",
    "My Little Boat",
    "My Little Suede Shoes",
    "My Old Flame",
    "My One And Only Love",
    "My Romance",
    "My Ship",
    "Mysterious Traveler",
    "Naima",
    "Nancy Joe",
    "Nardis",
    "Nature Boy",
    "Nearness Of You, The",
    "Nefertiti",
    "Never Will I Marry",
    "Nica's Dream",
    "Night And Day",
    "Night Dreamer",
    "Night Has A Thousand Eyes, The",
    "Nimbus",
    "No Me Esqueca",
    "No Moe",
    "Nonsequence",
    "North Atlantic Run",
    "Nostalgia In Times Square",
    "Now's The Time",
    "Nutville",
    "Off Minor",
    "Old Devil Moon",
    "Oleo",
    "Olhos De Gato",
    "On A Clear Day",
    "On The Trail",
    "Once I Loved",
    "Once In A While",
    "One By One",
    "One Finger Snap",
    "One Foot In The Gutter",
    "One For Daddy-O",
    "One Note Samba",
    "Open Your Eyes, You Can Fly",
    "Opus De Funk",
    "Orbits",
    "Ornithology",
    "Our Love Is Here To Stay",
    "Out Of Nowhere",
    "Oye Como Va",
    "Pannonica",
    "Passion Dance",
    "Patterns",
    "Peace",
    "Peaches En Regalia",
    "Pearlie's Swine",
    "Pee Wee",
    "Peggy's Blue Skylight",
    "Pennies From Heaven",
    "Penny Arcade",
    "Pensativa",
    "Pent-Up House",
    "People Will Say We're In Love",
    "Perdido",
    "Peri's Scope",
    "Pinocchio",
    "Pithecanthropus Erectus",
    "Played Twice",
    "Polka Dots And Moonbeams",
    "Portrait Of Jennie",
    "Portsmouth Figurations",
    "Prancing (No Blues)",
    "Preacher, The",
    "Prelude To A Kiss",
    "Prince Of Darkness",
    "Pussy Cat Dues",
    "Pursuance",
    "Quicksilver",
    "Quiet Now",
    "Ramblin'",
    "Raven, The",
    "Recado Bossa Nova",
    "Recorda Me",
    "Red Baron, The",
    "Red Clay",
    "Red Cross",
    "Reflections",
    "Remark You Made, A",
    "Revelation",
    "Robbin's Nest",
    "Round Trip",
    "Rubberneck",
    "Ruby, My Dear",
    "Sack Full Of Dreams",
    "Sadu",
    "Saint James Infirmary",
    "Saint Thomas",
    "Salt Peanuts",
    "Samba De Orfeu",
    "Sandu",
    "Satin Doll",
    "Scene Is Clean, The",
    "Scrapple From The Apple",
    "Search For Peace",
    "September In The Rain",
    "September Song",
    "Serenade To A Bus Seat",
    "Serenade To A Cuckoo",
    "Serenade To A Soul Sister",
    "Serene",
    "Serenity",
    "Seven Steps To Heaven",
    "Seventeen West",
    "Shiny Stockings",
    "Short Stop",
    "Sidewinder, The",
    "Silver's Serenade",
    "Simone",
    "Since I Fell For You",
    "Sippin' At Bell's",
    "Sister Sadie",
    "Skating In Central Park",
    "Skylark",
    "Slipped Disc",
    "Slow Hot Wind",
    "Smoke Gets In Your Eyes",
    "So Near, So Far",
    "So What",
    "Softly As In A Morning Sunrise",
    "Softly As A Morning Sunrise",
    "Solar",
    "Some Day My Prince Will Come",
    "Some Other Blues",
    "Someone To Watch Over Me",
    "Song For My Father",
    "Song For My Lady",
    "Sophisticated Lady",
    "Soul Eyes",
    "Soultrane",
    "Space Circus",
    "Speak Like A Child",
    "Speak Low",
    "Speak No Evil",
    "Spiral",
    "Spring Can Really Hang You Up The Most",
    "Star Eyes",
    "Stardust",
    "Stella By Starlight",
    "Stolen Moments",
    "Stompin' At The Savoy",
    "Straight Life",
    "Straight No Chaser",
    "Strayhorn",
    "Street Of Dreams",
    "Strode Rode",
    "Strollin'",
    "Struttin' With Some Barbecue",
    "Sub-Conscious-Lee",
    "Sugar",
    "Summer In Central Park",
    "Summer Night",
    "Summertime",
    "Sunshine Express",
    "Surrey With The Fringe On Top, The",
    "Sweet And Lovely",
    "Sweet Georgia Brown",
    "Sweetest Sounds, The",
    "Syeeda's Song Flute",
    "Tadd's Delight",
    "Take Five",
    "Take The A Train",
    "Taking A Chance On Love",
    "Tangerine",
    "Tautology",
    "Teach Me Tonight",
    "Tenderly",
    "Tenor Madness",
    "That's All",
    "The Duke",
    "The Jody Grind",
    "Theme For Ernie",
    "Theme From Mr. Broadway",
    "There Is No Greater Love",
    "There Will Never Be Another You",
    "These Foolish Things",
    "Things Ain't What They Used To Be",
    "Things To Come",
    "Thinking Of You",
    "This Could Be The Start Of Something",
    "This Masquerade",
    "Three Base Hit",
    "Three Views Of A Secret",
    "Thriving On A Riff",
    "Tickle-Toe",
    "Till There Was You",
    "Time After Time",
    "Time Remembered",
    "Tones For Joan's Bones",
    "Trane's Blues",
    "Trinkle Tinkle",
    "Triste",
    "Tune Up",
    "Turn Around",
    "Turn Out The Stars",
    "Turning Point, The",
    "Ugly Beauty",
    "Un Poco Loco",
    "Unforgettable",
    "Unit Seven",
    "Up Jumped Spring",
    "Upper Manhattan Medical Group",
    "Valse Hot",
    "Very Early",
    "Virgo",
    "Vonetta",
    "Voyage",
    "Wait Till You See Her",
    "Walkin' Shoes",
    "Waltz For Debby",
    "Watch What Happens",
    "Water Colors",
    "Watermelon Man",
    "Wave",
    "Way You Look Tonight, The",
    "We'll Be Together Again",
    "Weekend Blues",
    "Well You Needn't",
    "Wendy",
    "West Coast Blues",
    "What A Wonderful World",
    "What Is This Thing Called Love",
    "What's New",
    "When I Fall In Love",
    "When Lights Are Low",
    "When Sunny Gets Blue",
    "Where Or When",
    "Whisper Not",
    "Who Can I Turn To",
    "Wild Flower",
    "Willow Weep For Me",
    "Windows",
    "Witch Hunt",
    "Woody'n You",
    "Work Song",
    "Wrong Is Right",
    "Yardbird Suite",
    "Yesterdays",
    "You And The Night And The Music",
    "You Are Too Beautiful",
    "You Better Leave It Alone",
    "You Don't Know What Love Is",
    "You Go To My Head",
    "You Stepped Out Of A Dream",
    "You'd Be So Nice To Come Home To",
    "Young And Foolish",
  ];
}
