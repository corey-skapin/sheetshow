#!/usr/bin/env bash
# Pre-commit checks — run automatically before every commit.
# Enable on a fresh clone with: git config core.hooksPath .githooks
set -euo pipefail

# Locate dart — check PATH, then common Windows install locations.
if command -v dart &>/dev/null; then
  DART=dart
elif command -v flutter &>/dev/null; then
  DART="flutter pub run dart"
else
  for candidate in \
    "$HOME/flutter/bin/dart" \
    "/c/Users/$USERNAME/flutter/bin/dart" \
    "/c/flutter/bin/dart" \
    "/c/tools/flutter/bin/dart"; do
    if [ -x "$candidate" ]; then DART="$candidate"; break; fi
  done
fi

if [ -z "${DART:-}" ]; then
  echo "⚠ dart not found — skipping format check. Install Flutter and re-run." >&2
  exit 0
fi

echo "▶ dart format check (client)..."
cd client
$DART format --set-exit-if-changed lib/ test/
cd ..

echo "✓ All pre-commit checks passed."
